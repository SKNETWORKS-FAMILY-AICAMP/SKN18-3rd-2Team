# RAG 기반 약품 정보 시스템

## 📋 프로젝트 개요
- **백터DB**: PostgreSQL + pgvector
- **LLM**: Ollama (gemma2:4b)
- **임베딩**: HuggingFace (ko-sroberta-multitask)
- **데이터**: 4,710개 약품 정보 (23,953개 청크)

## 🚀 실행 명령어

### 1. 데이터 로딩 명령어
#### 도커(Docker) 설치 명령어

야놀파일 존재 확인

docker-compose up -d


#### 약품 데이터 로딩
```bash
cd backend/load_data
python main_loader.py
```

**로딩 결과:**
- JSON 데이터: 4,710개 약품
- 텍스트 청크: 23,953개
- 데이터베이스: 23,953개 레코드 (ID 1~23,953)

### 2. RAG 시스템 실행 명령어

#### 메인 시스템 실행
```bash
cd backend
python main.py
```

**실행 결과:**
- Ollama 모델 로드
- 백터DB 검색
- 질문 유형 판단
- 답변 생성

## 🔧 사전 준비사항

### 1. Ollama 모델 설치
```bash
ollama pull gemma2:4b
```

### 2. PostgreSQL 데이터베이스 설정
- **호스트**: localhost
- **포트**: 55432
- **데이터베이스**: vectordb
- **사용자**: admin
- **비밀번호**: admin123

### 3. Python 패키지 설치
```bash
pip install -r requirements.txt
```

## 📊 시스템 구조

```
backend/
├── main.py                 # 메인 실행 파일
├── RAG/
│   ├── langgraph.py        # RAG 워크플로우
│   ├── model.py           # LLM/임베딩 모델
│   └── custom_pgvector.py # 백터DB 커스텀 클래스
├── load_data/
│   ├── main_loader.py     # 데이터 로딩
│   ├── config.py          # DB 설정
│   └── clean_reset.py     # DB 초기화
└── data/
    └── drug_info_preprocessed.json  # 약품 데이터
```

## 🎯 주요 기능

### 1. 질문 유형 판단
- 약/증상 관련 질문 자동 판별
- 관련 없는 질문 적절히 거부

### 2. 백터DB 검색
- 유사도 기반 문서 검색
- 상위 4개 관련 문서 반환

### 3. 답변 생성
- 검색된 문서 기반 답변 생성
- 한국어 자연스러운 응답

## 🐛 문제 해결

### 1. Ollama 모델 오류
```bash
ollama pull gemma2:4b
```

### 2. 데이터베이스 연결 오류
- PostgreSQL 서비스 실행 확인
- 포트 55432 확인

### 3. ID 시퀀스 문제
```bash
cd backend/load_data
python clean_reset.py
python main_loader.py
```

## 📈 성능 정보

- **데이터 로딩 시간**: ~20초 (23,953개 레코드)
- **검색 속도**: ~1초 (4개 문서 검색)
- **답변 생성**: ~3-5초 (Ollama 모델)

## 🔍 테스트 질문 예시

1. "게보린정에 대해 알려주세요"
2. "두통에 좋은 약이 뭐야?"
3. "감기약 추천해주세요"
4. "알파간피 점안액에 대해 알려주세요"